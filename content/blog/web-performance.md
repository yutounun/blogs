---
external: false
draft: false
title: 「Web フロントエンド ハイパフォーマンス チューニング」を読んで要点をまとめた
description: 「Web フロントエンド ハイパフォーマンス チューニング」を読んで要点をまとめた
date: 2024-04-10
categories:
  - front-end
  - web-development
  - performance
---

# 1. web パフォーマンスとは何か

「ユーザーの振る舞いに対してブラウザが応答を返す速さ」

元々は「インタラクション」といえばページ遷移のみを指していたが、今はページ内でモーダル開閉など様々な「インタラクション」が存在する

# 2. ブラウザのレンダリングの仕組み

※ 下記 4 つのレンダリング工程の総称を"Frame"と呼ぶ

## レンダリングエンジン

ブラウザの内部で利用される HTML の描画エンジン(ブラウザそのものではない)

Chrome であれば Blink というレンダリングエンジンを利用

## JavaScript エンジン

JavaScript の実行環境を提供するソフトウェアコンポーネント

Chrome であれば V8

## レンダリングの流れ

### Loading

- リソース(HTML, CSS, JS, Image)をサーバーからダウンロード
- リソースをパース(構文解析)し、レンダリングエンジンの内部表現に変換
- HTTP(HTTPS) / IP / TCP のプロトコルを利用し、データはパケットに含まれる

1. 最初に HTML を読み込み、HTML 内の参照を通して再起的に CSS などを読み込む。ここは並列処理。
2. HTML と CSS をパースして、DOM ツリーと CSS 用の CSSOM ツリーを構築する

#### HTML→DOM ツリー

1. 字句解析：HTML の文字列がトークンと呼ばれる意味のあるチャンクに分割されます。これらのトークンは HTML のタグ、属性、内容などを表します。
2. 構文解析：これらのトークンが構文木に整理されます。構文木は文書の階層構造をネストされた形で表します。1,3 の中間。
3. DOM ツリーの構築：構文木からブラウザが操作できる DOM ツリー(検証ツールの Elements のようなもの)が作成されます。この過程では、構文木内にある JavaScript が実行されることもあり、これが DOM ツリーの構築に影響を与えることがあります。

### Scripting

1. 字句解析: console.log("hello")を"console",".","log", "(","hello",")"のようにトークンに分ける
2. 構文解析: トークン列を抽象構文木にする
3. コンパイル: コンパイラによる機械語への変換
4. 実行: console に"hello"を出力したり、API call して loading フェーズに戻ることも

※ scripting が rendering の前に実行されるため、同期関数を実行すると rendering がその分遅れる

### Rendering

1. CSS のセレクタ名と DOM のマッチング処理
2. 適用されるスタイルの算出: 被っている CSS などがある場合、どのスタイルを優先・適用するかを決める。style=""に書くと優先度が高いなど色々ある。
3. レイアウト: 大きさやマージンなどの計算を行う

### Painting

1. Paint: 簡単なスタイル適用の命令を作成
2. Rasterize: 上記の命令をもとにピクセルでできたレイヤーへ描画
3. レイヤーの合成: 上記で作成した重なり合ったレイヤーなどを合成

### (状況によっては)再レンダリング

React の State 変更時などの再レンダリング時に全てのレンダリング処理が全てやり直しになるのではなく、必要な手順からやり直しを行う
